---
phase: 01-foundation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/01-foundation/UPG-STRUCTURE-CATALOG.md
autonomous: false
requirements: []
must_haves:
  truths:
    - "A UPG structure catalog document exists describing the syntax, section patterns, block delimiters, variable references, and library include syntax observed in 20+ real corpus files"
    - "The catalog covers the top 3 controller types (HAAS, Fanuc, Mori Seiki) with good representation across all three"
    - "The catalog documents all 7 UPG file types (.SRC, .LIB, .CTL, .KIN, .ATR, .PINF, .LNG) with observed patterns for each"
    - "The catalog provides a section taxonomy with naming conventions sufficient for parser regex/grammar design in Phase 2"
    - "The catalog documents variable reference syntax (<VAR>, <G:CODE>, <M:CODE>), conditional patterns (IF/THEN/ELSE), and CALC section logic"
  artifacts:
    - path: ".planning/phases/01-foundation/UPG-STRUCTURE-CATALOG.md"
      provides: "Comprehensive UPG format reference derived from real corpus annotation"
      contains: "SECTION="
  key_links:
    - from: ".planning/phases/01-foundation/UPG-STRUCTURE-CATALOG.md"
      to: "Phase 2 parser"
      via: "Parser grammar and regex patterns are derived from catalog observations"
      pattern: "N/A — document consumed by Phase 2 planner"
---

<objective>
Collect 20+ real UPG corpus files across 3 controller types (HAAS, Fanuc, Mori Seiki) and produce a comprehensive UPG structure catalog document. This catalog is the reference that Phase 2 parser development builds from.

Purpose: The UPG format is proprietary with sparse public documentation. Without a catalog derived from real files, the Phase 2 parser would be designed against assumptions rather than evidence. This is Phase 1's fourth success criterion.

Output: `UPG-STRUCTURE-CATALOG.md` in the phase directory — a syntax/structure reference (not a semantic interpreter).
</objective>

<execution_context>
@C:/Users/CameronCarson/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/CameronCarson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Download additional UPG corpus files from SharePoint</name>
  <action>
The local corpus at C:\CAM CONTENT has only 2 complete packages (HAAS VF-4 Mill, HAAS ST-15Y MillTurn). The 20+ file target requires additional packages.

The user needs to download representative packages from the HRS SharePoint post processor library. Claude cannot access SharePoint.
  </action>
  <how-to-verify>
Download UPG post processor packages from the HRS SharePoint library into `C:\CAM CONTENT\Corpus` (or any folder — just tell Claude where).

**Target:**
- **HAAS**: 2 already available locally. Download 4-5 more HAAS packages (different machine models — mix of Mill, MillTurn, Lathe if available)
- **Fanuc**: Download 7+ packages for Fanuc-controlled machines (Doosan, Okuma, or any Fanuc-dialect machines). Each must include at minimum a .SRC file.
- **Mori Seiki (Mitsubishi controller)**: Download 7+ packages. Each must include at minimum a .SRC file.

**What constitutes a "package":** A folder or ZIP containing some combination of .SRC, .LIB, .CTL, .KIN, .ATR, .PINF, .LNG files. At minimum the .SRC file must be present.

**Total target:** 20+ packages across 3 controller types with good coverage (not 18 HAAS + 1 Fanuc + 1 Mori Seiki).

When done, provide the path to the downloaded files so Claude can scan and annotate them.
  </how-to-verify>
  <resume-signal>Provide the path to the downloaded corpus files (e.g., "Files are in C:\CAM CONTENT\Corpus") and list how many packages per controller type you downloaded</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Annotate corpus and produce UPG structure catalog</name>
  <files>
    .planning/phases/01-foundation/UPG-STRUCTURE-CATALOG.md
  </files>
  <action>
Scan all corpus files (local C:\CAM CONTENT packages + user-downloaded packages) and produce a comprehensive structure catalog.

**Annotation depth (Claude's Discretion — per research recommendation):**
Document what downstream phases need — pattern inventory and structure reference. Do NOT attempt deep semantic annotation of what each CALC section "means."

**The catalog must include these sections:**

### 1. Corpus Inventory
- Table of all annotated files: package name, controller type, machine type, file types present, SRC line count
- Summary statistics: total packages, files per type, controller distribution

### 2. File Type Anatomy (one subsection per file type)
For each of the 7 file types (.SRC, .LIB, .CTL, .KIN, .ATR, .PINF, .LNG):
- Overall structure and purpose
- Section ordering (for SRC: header → defines → attributes → libraries → sections → CALC)
- Delimiter patterns (what marks the start/end of each block)
- Example snippets from real files (with file attribution)
- Variations observed across controller types

### 3. Syntax Pattern Inventory
Document every syntactic construct observed, with regex-ready patterns:
- Comment syntax: `*` line prefix
- Define directives: `:DEFINE NAME=value`
- Section declarations: `:SECTION=NAME`
- Template lines: `:T: content with <VARIABLE> references`
- Conditional patterns: `:T: IF condition THEN ... ENDIF`
- CALC logic: `:IF ... THEN ... :ENDIF`, `:ELSE`, `CALL(SECTION)`
- Library includes: `:LIBRARY=path`
- Attribute blocks: `:ATTRNAME=...` through `:ATTREND`
- Operation tab definitions: `:OPERID=...` through `:OPEREND`
- Header settings: `:SYSTEM=`, `:LEADING=`, `:TRAILING=`, etc.
- Variable reference tokens: `<VAR>`, `<VAR!>`, `<G:CODE>`, `<M:CODE>`, `<EOL>`, `<BLANK>`

### 4. Section Taxonomy
- Named section categories with examples from each controller type
- Naming conventions (e.g., `CALC_` prefix for computational sections, `_MILL` / `_TURN` suffixes)
- Cross-controller commonalities and controller-specific sections
- Section count ranges per SRC file

### 5. Cross-File Reference Patterns
- How SRC files reference LIB files (`:LIBRARY=` directive)
- How LIB files extend/override SRC defines
- ATR file role in variable registry
- Library path resolution issue (absolute Windows paths — per research Pitfall 7)

### 6. Controller-Specific Observations
For each of the 3 controller types:
- Unique patterns not seen in other controllers
- Section naming conventions specific to that controller
- Variable naming patterns
- Any structural deviations from the common pattern

### 7. Parser Design Implications
- Recommended tokenizer approach (line-by-line vs multi-line)
- Key delimiter characters and their roles
- Ambiguity points the parser must handle
- Suggested parse phases (header parse → section split → template parse → CALC parse)

**Process:**
1. Scan the user-provided corpus path to identify all UPG files
2. Read each .SRC file and extract structural patterns
3. Read representative .LIB, .CTL, .KIN, .ATR, .PINF, .LNG files
4. Cross-reference patterns across controller types
5. Compile into the catalog structure above
6. Include real code snippets (attributed to source file) — do NOT fabricate examples
  </action>
  <verify>
- File exists at `.planning/phases/01-foundation/UPG-STRUCTURE-CATALOG.md`
- Document covers all 7 sections listed above
- Document references 20+ real files by name
- All 3 controller types are represented
- All 7 file types are documented
- Code snippets are from real files (not fabricated)
  </verify>
  <done>
UPG structure catalog exists, derived from 20+ real corpus files across 3 controller types. The catalog documents file anatomy, syntax patterns, section taxonomy, cross-file references, controller-specific observations, and parser design implications — everything Phase 2 needs to build the parser grammar.
  </done>
</task>

</tasks>

<verification>
1. `UPG-STRUCTURE-CATALOG.md` exists and is >2000 lines (comprehensive catalog from 20+ files will be substantial)
2. Corpus inventory table lists 20+ packages across 3 controller types
3. All 7 UPG file types have documented anatomy sections
4. Syntax pattern inventory includes regex-ready patterns for each construct
5. Parser design implications section provides actionable guidance for Phase 2
</verification>

<success_criteria>
- 20+ real corpus files annotated across HAAS, Fanuc, and Mori Seiki controller types
- All 7 UPG file types (.SRC, .LIB, .CTL, .KIN, .ATR, .PINF, .LNG) documented with structure patterns
- Syntax patterns documented with enough precision for parser regex/grammar design
- Section taxonomy covers naming conventions and cross-controller commonalities
- Document is a usable reference for Phase 2 parser development
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
